---
title: Dashboard
author: Henry Linder (mhlinder@gmail.com)
date: "`r format(Sys.time(), '%B %d, %Y')`"
output: html_document
---

# Setup

```{r message = FALSE}
library(magrittr)
library(dplyr)
library(knitr)
```

A cronjob executes every two weeks, which runs the file `get_data.R`
(the source is included at the end of this file). The script saves a
dated file in the directory `data/`.

```{r}
infiles <- list.files("data", full.names = TRUE)
n_infiles <- length(infiles)
infiles[n_infiles]
```

We load the most recent data file, which contains the master variable
`out`.

```{r}
load(infiles[n_infiles])

daily <-
    out$daily %>%
    as.data.frame %>%
    tbl_df

## Removes day zero, which does not record a full day
daily <- daily[-1,]
n <- nrow(daily)

## Removes day n, which is incomplete by dint of when the data was collected
daily <- daily[-n,]
n <- nrow(daily)

names(out)
```

# EDA

We start by considering daily historical step count, which is stored
in `daily$steps.time`. We also check whether there are any missing
days, because we assume there are none.

```{r}
dates <-
    daily$steps.time %>%
    as.Date

all_days <-
    seq.Date(dates[1], dates[n], by = "day") %>%
    as.character
d <- as.character(dates)

if (!all(d == all_days)) {
    stop("Missing days in input data!")
}
```

```{r fig.align = "center"}
y <- daily$steps.steps

plot(dates, y, type = "l",
     xlab = "",
     ylab = "Steps",
     main = "Steps by day",
     xaxt = "n")

## Count backwards by week from the last observation
at <- seq.Date(dates[n], dates[1], by = "-1 week")
axis(1, at = at, labels = as.character(at))
```



# Code

```{r cache = FALSE, echo = FALSE}
read_chunk("get_data.R")
```
```{r get-data, eval = FALSE}
```

